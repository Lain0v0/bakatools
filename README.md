# bakatools

一些自己日常用的小脚本，简单无脑使用，运行环境为 Windows 系统，其他系统未测试~  
不是程序员，不会敲代码，纯兴趣爱好和为了自己方便，大部分代码是通过 AI 辅助生成，自己再根据看得懂的部分和注释修改而成。  
需要 python 的运行环境，windows 可以直接微软商店安装，会默认配置好环境。

# 批处理

批处理运行模板，选择自己喜欢的方式使用即可。

## baka.bat

多脚本批处理模板，放在相应的脚本文件夹，选择要用的脚本即可。

<details>

### 功能说明

- 自动扫描当前目录所有.py 文件，动态生成带编号的脚本列表
- 单个脚本时自动确认执行，多个脚本时显示选择菜单
- 支持拖放文件，中英文路径和文件名，会自动识别需不需要引号

### 小技巧

要优先执行特定脚本，可在文件名前加数字排序，例如：

```
00_videosplitter.py
01_videocut.py
```

需要管理员权限时，在 bat 文件开头添加：

```
fltmc >nul 2>&1 || (
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    echo UAC.ShellExecute "%~s0", "", "", "runas", 1 >> "%temp%\getadmin.vbs"
    "%temp%\getadmin.vbs"
    del "%temp%\getadmin.vbs"
    exit /b
)
```

需要指定 Python 版本时，修改执行命令为：

```
"C:\Python310\python.exe" "%%a" %*
```

</details>

## baaka.bat

单脚本批处理模板，修改运行脚本名称运行对应脚本。

# 脚本

各种小工具的简单使用说明，会慢慢根据需求补充。

## Anime

### anime_sort

对动漫资源进行文件分类整理，适配 emby 的命名规则。

<details>


以 VCB-Studio 的资源为例：

```
- anime_sort
    - CM        # 电视放送广告
    - IV        # 节目、采访、舞台活动、制作
    - Menus     # BD/DVD 播放选择菜单
    - OPED      # 无字 OP/ED
    - PV        # 预告片
```

将`SPs`文件夹直接拖入`SPs通用整理.bat`，会自动根据文件夹内文件文件名关键词创建相关文件夹和元数据，分类放入对应的文件夹内，直接将分类文件夹移动至季文件夹同一目录下，例如：

```
- 碧蓝之海 (2018)
    - Season 1 (2018) [UHA-WINGS@VCB-Studio] # 第一季文件
    - PV        # 预告片
```

最终在 emby 资源库季末尾显示，效果如下：

![emby预览](anime/anime_sort/preview.webp)

如需要识别大小写，则在批处理程序中修改运行脚本文件为`sp_sort_Aa.py`。

如是 VCB-Studio 的资源，可直接将下载整个文件夹拖入`VCB-Studio整理专用.bat`，脚本会显示对应动漫的 TMDB 链接，填入第几季、季年份、动漫中文名称后，在通用分类的基础上，还会对文件进行重命名以适配 emby：

```
- 碧蓝之海 (2018)
    - [VCB-Studio] Grand Blue [Ma10p_1080p]
        - [VCB-Studio] Grand Blue [01][Ma10p_1080p][x265_flac_aac].mkv
-------------  ↓  -----------------
- 碧蓝之海 (2018)
    - Season 1 (2018) [VCB-Studio]
        - 碧蓝之海 - S01E01 - 1080p.mkv
```

**硬链接：** 直接在`hlink.py`中开头的配置文件中根据需求设置。

</details>

### subsetfonts

字幕字体子集化脚本，主要功能基于**wyzdwdz**大佬制作的[子集化工具](https://bbs.acgrip.com/thread-9897-1-1.html)，喜欢 GUI 版本可去下载。

字体子集化是将字体拆分嵌入 ass 字幕文件内，可以让不具备字体文件的客户端也能正常显示带有字体的字幕，增加观看体验。

<details>

使用前，需要预先准备好字体库，如[超级字体整合包 XZ](https://vcb-s.com/archives/1114)，将`更新字体数据库.bat`内的字体库路径改为字体存放路径。字体子集化工具具体使用命令请看原贴，已经非常详细。

`字体子集化.bat`：将需要子集化的字幕文件（单个或多个，不能是文件夹）拖入批处理中，子集化工具会自动生成新的字幕文件，其中带`.rename.assfonts.ass`后缀的是子集化后的字幕。

`清理字体文件.bat`：将有子集化后的字幕文件夹拖入，可以自动将多余的文件和文件夹移至`.cache`的缓存文件夹，仅留下带`.rename.assfonts.ass`后缀的字幕。每次运行都会先清空缓存文件夹，因此如果误操作后后悔，原文件还可在缓存文件夹中找到。

`更新字体数据库.bat`：字体库添加新字体后都需要对数据库进行更新。

`字体格式转换.bat`：字体子集化的字体文件必须是 ttf 格式，可将 otf 字体文件或文件夹拖入，自动转换成 ttf 格式并按原路径分类保存在输出目录下。输出目录需要在`otf2ttffonts.py`中设定。

`字体转换匹配.bat`：如已经有许多同名但是格式不同的字体文件，可以使用该批处理程序将字体文件移入对应的分类目录下。原目录和目标目录需要在`matchfonts.py`中设定。

#### 常见问题

**1. 子集化时提示没有某些字体怎么办？**  
获取字幕的地方一般会包括字体文件，找到缺少的字体放入字体库中，再更新字体数据库。

**2. 子集化时提示某些字体缺少某个字符怎么办？**  
情况多为一些特殊字符，对应字体中没有相应字符，一般情况下可直接忽视。实在想改需要手动修改字体文件添加字符。

**3. 子集化时提示某些字体缺少大量字符怎么办？**  
情况多为字幕简繁转换造成，字幕中原字体样式为繁体字体，而实际使用的是简体字体。能无障碍看懂繁体字幕的，建议直接使用原版的繁体字幕做子集化。实在想用简体，可以使用 Aegisub 工具，在字体样式中将原本的繁体字体更改成对应的简体字体，操作比较繁琐，需要耐心。

</details>

## Video

依赖于 ffmpeg，需要安装对应环境依赖：

```
pip install ffmpeg-python
```

具体配置可以看脚本内注释修改。

<details>

### video_splitter

视频无损分割，输入视频分割时间节点，即可切割（1 个节点分割成 2 份，2 个分割成 3 份，以此类推），输入完成后按两下 `Enter` 即可确认。

配合 mpv 的复制当前时间快捷键可以更方便的使用。

### video_cut

视频无损切片，输入开始时间和结束时间，输入完成后按两下 `Enter` 即可确认。

配合 mpv 的复制当前时间快捷键可以更方便的使用。

### video_delete

视频片段无损删除，输入片段前后时间点，切除不想要的视频片段，并将剩余的片段合并。因关键帧对齐，最终视频可能会比原视频稍短。

配合 mpv 的复制当前时间快捷键可以更方便的使用。

### video_merger

对相同录制参数的视频，按照从先到后的顺序合并为一个新的视频。

### video_2mp4

无损转换视频为 mp4 格式，支持批量文件和文件夹混合输入。

### video_2social

转换视频为普通清晰度的 mp4 格式，并转换为 30 帧，适合直接将视频分享到 qq 群、X 等社交媒体平台的情况。

### video_2gif

转换视频为普通清晰度的 gif 动图，适合直接将短视频做成动图分享到 qq 群等社交媒体平台的情况。

建议配合 video2social 使用。

### video_compress

通用的压制视频的脚本，不常用。

### ytb_coverdl

批量下载 youtube 视频封面，在保存位置用 txt 格式建立文本文件，填入图片网址，每行一个，不需要符号分割。

</details>
